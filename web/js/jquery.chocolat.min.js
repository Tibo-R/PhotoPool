(function(b){images=new Array();var a=0;b.fn.Chocolat=function(g){g=b.extend({container:b("body"),displayAsALink:false,linkImages:true,linksContainer:"Choco_links_container",overlayOpacity:0.9,overlayColor:"#fff",fadeInOverlayduration:500,fadeInImageduration:500,fadeOutImageduration:500,vache:true,separator1:" | ",separator2:"/",leftImg:"images/left.gif",rightImg:"images/right.gif",closeImg:"images/close.gif",loadingImg:"images/loading.gif",currentImage:0,setIndex:0,setTitle:"",lastImage:0},g);a++;g.setIndex=a;images[g.setIndex]=new Array();this.each(function(i){if(i==0&&g.linkImages){if(g.setTitle==""){g.setTitle=o(b(this).attr("rel")," ")}}b(this).each(function(){images[g.setIndex]["displayAsALink"]=g.displayAsALink;images[g.setIndex][i]=new Array();images[g.setIndex][i]["adress"]=o(b(this).attr("href")," ");images[g.setIndex][i]["caption"]=o(b(this).attr("title")," ");if(!g.displayAsALink){b(this).unbind("click").bind("click",{id:g.setIndex,nom:g.setTitle,i:i},r)}})});for(var l=0;l<images[g.setIndex].length;l++){if(images[g.setIndex]["displayAsALink"]){if(b("#"+g.linksContainer).size()==0){this.filter(":first").before('<ul id="'+g.linksContainer+'"></ul>')}b("#"+g.linksContainer).append('<li><a href="#" id="Choco_numsetIndex_'+g.setIndex+'" class="Choco_link">'+g.setTitle+"</a></li>");e=this.parent();b(this).remove();if(b.trim(e.html())==""){e.remove()}return b("#Choco_numsetIndex_"+g.setIndex).unbind("click").bind("click",{id:g.setIndex,nom:g.setTitle,i:g.currentImage},r)}}function r(i){g.currentImage=i.data.i;g.setIndex=i.data.id;g.setTitle=i.data.nom;g.lastImage=images[g.setIndex].length-1;f();return false}function h(){m();g.container.append('<div id="Choco_overlay"></div><div id="Choco_content"><div id="Choco_close"></div><div id="Choco_loading"></div><div id="Choco_container_photo"><img id="Choco_bigImage" src="" /></div><div id="Choco_container_description"><span id="Choco_container_title"></span><span id="Choco_container_via"></span></div><div id="Choco_left_arrow" class="Choco_arrows"></div><div id="Choco_right_arrow" class="Choco_arrows"></div></div>');b("#Choco_left_arrow").css("background-image","url("+g.leftImg+")");b("#Choco_right_arrow").css("background-image","url("+g.rightImg+")");b("#Choco_close").css("background-image","url("+g.closeImg+")");b("#Choco_loading").css("background-image","url("+g.loadingImg+")");if(g.container.get(0).nodeName.toLowerCase()!=="body"){g.container.css({position:"relative",overflow:"hidden","line-height":"normal"});b("#Choco_content").css("position","relative");b("#Choco_overlay").css("position","absolute")}b(document).unbind().bind("keydown",function(i){switch(i.keyCode){case 37:n(-1);break;case 39:n(1);break;case 27:s();break}});if(g.vache){b("#Choco_overlay").click(function(){s();return false})}b("#Choco_left_arrow").unbind().bind("click",function(){n(-1);return false});b("#Choco_right_arrow").unbind().bind("click",function(){n(1);return false});b("#Choco_close").unbind().bind("click",function(){s();return false});b(window).resize(function(){q(g.currentImage,true)})}function f(){h();q(g.currentImage,false);b("#Choco_overlay").css({"background-color":g.overlayColor,opacity:g.overlayOpacity}).fadeIn(g.fadeInOverlayduration);b("#Choco_content").fadeIn(g.fadeInImageduration,function(){})}function q(u,t){g.currentImage=u;b("#Choco_loading").fadeIn(g.fadeInImageduration);var i=new Image();i.onload=function(){b("#Choco_bigImage").attr("src",images[g.setIndex][g.currentImage]["adress"]);var v=k(i.height,i.width);d(v.hauteur,v.largeur,t);b("#Choco_loading").stop().fadeOut(g.fadeOutImageduration)};i.src=images[g.setIndex][g.currentImage]["adress"];p();j()}function n(i){if(!g.linkImages){return false}else{if(g.currentImage==0&&i==-1){return false}else{if(g.currentImage==g.lastImage&&i==1){return false}else{b("#Choco_container_description").fadeTo(g.fadeOutImageduration,0);b("#Choco_bigImage").fadeTo(g.fadeOutImageduration,0,function(){q(g.currentImage+parseInt(i),false)})}}}}function d(i,u,t){if(t){b("#Choco_container_photo, #Choco_content, #Choco_bigImage").stop(true,false).css({overflow:"visible"});b("#Choco_bigImage").animate({height:i+"px",width:u+"px",},g.fadeInImageduration)}b("#Choco_container_photo").animate({height:i,width:u},g.fadeInImageduration);b("#Choco_content").animate({height:i,width:u,marginLeft:-u/2,marginTop:-(i)/2},g.fadeInImageduration,"swing",function(){b("#Choco_bigImage").fadeTo(g.fadeInImageduration,1).height(i).width(u).fadeIn(g.fadeInImageduration);if(!t){c();b("#Choco_container_description").fadeTo(g.fadeInImageduration,1);b("#Choco_close").fadeIn(g.fadeInImageduration)}}).css("overflow","visible")}function c(){if(g.linkImages){var u=new Array("Choco_right_arrow","Choco_left_arrow");for(var t=0;t<u.length;t++){hide=false;if(u[t]=="Choco_right_arrow"&&g.currentImage==g.lastImage){hide=true;b("#"+u[t]).fadeOut(300)}else{if(u[t]=="Choco_left_arrow"&&g.currentImage==0){hide=true;b("#"+u[t]).fadeOut(300)}}if(!hide){b("#"+u[t]).fadeIn(g.fadeOutImageduration)}}}}function p(){if(g.currentImage!==g.lastImage){l=new Image;z=g.currentImage+1;l.src=images[g.setIndex][z]["adress"]}}function j(){var t=g.currentImage+1;var i=g.lastImage+1;b("#Choco_container_title").html(images[g.setIndex][g.currentImage]["caption"]);b("#Choco_container_via").html(g.setTitle+g.separator1+t+g.separator2+i)}function o(t,i){if(t===undefined){return i}else{return t}}function k(x,w){var t=w+(w*28/100);var u=x+51;var i=w/x;var v=x/w;if(g.container.get(0).nodeName.toLowerCase()=="body"){windowHeight=b(window).height();windowWidth=b(window).width()}else{windowHeight=g.container.height();windowWidth=g.container.width()}notFitting=true;while(notFitting){var t=w+(w*28/100);var u=x+51;if(t>windowWidth){w=windowWidth*100/128;x=v*w}else{if(u>windowHeight){x=(windowHeight-51);w=i*x}else{notFitting=false}}}return{largeur:w,hauteur:x}}function m(){b("#Choco_overlay").remove();b("#Choco_content").remove()}function s(){b("#Choco_overlay").fadeOut(900,function(){b("#Choco_overlay").remove()});b("#Choco_content").fadeOut(500,function(){b("#Choco_content").remove()});g.currentImage=0}}})(jQuery);